var file_frame,cwForms,cwSetupForms;jQuery(document).ready(function(a){var b=function(a){var b=a.find(".cw-widget-data").val(),c=b?JSON.parse(b):{},d=a.find(".cw-items");"{}"!==JSON.stringify(c)&&(d.html(""),c.forEach(function(a){var b="";for(var c in a)if(a.hasOwnProperty(c)){var e="data-"+c.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),f=a[c];b+=e+'="'+f+'"'}d.append("<div "+b+">"+a.title+"</div>")}))},c=function(a){{var c=a.find(".cw-inner-form"),e=c.find(".cw-current-data"),f=e.val(),g=f?JSON.parse(f):{},h=a.find(".cw-widget-data"),i=h.val(),j=i?JSON.parse(i):[];c.find(".cw-error")}"{}"!==JSON.stringify(g)&&(g.key=Math.round((new Date).getTime()),j.push(g),h.val(JSON.stringify(j)),d(a),b(a))},d=function(a){var b=a.find(".cw-inner-form"),c=b.find(".image-preview"),d=b.find(".cw-remove-image"),e=b.find(".cw-instance-title"),f=b.find(".cw-instance-url"),g=b.find(".cw-current-data");d.hide(),e.val(""),f.val(""),g.val(""),c.html("")},e=function(b,c){if(0!==b.length){var d=b.find(".cw-inner-form"),e=d.find(".cw-current-data"),f=e.val(),g=d.find(".cw-instance-title"),h=d.find(".cw-instance-url"),i=b.find(".cw-attach-image"),j=i.data("imageUrl"),k=i.data("imageId"),l=g.val(),m=h.val(),n=f?JSON.parse(f):{};if(n.imageId=k,n.imageUrl=j,""===a.trim(l)){var o="Title is required.";return void d.find(".cw-error").html(o).delay(5e3).fadeOut(function(){a(this).html(""),a(this).show()})}n.title=l,""!==m&&(n.url=m),e.val(JSON.stringify(n)),"function"==typeof c&&c()}};a("body").on("keypress",".cw-instance-title, .cw-instance-url",function(b){13===b.which&&(b.preventDefault(),a(this).closest(".widget").find(".cw-add-instance").click())}),a("body").on("click",".cw-add-instance",function(b){b.preventDefault();var d=a(this).closest(".widget");e(d,function(){c(d)})}),a("body").on("click",".cw-remove-image",function(b){b.preventDefault();var c=a(this).closest(".widget"),d=c.find(".cw-inner-form"),e=d.find(".image-preview"),f=d.find(".cw-attach-image"),g=d.find(".cw-remove-image"),h=confirm("Are you sure you wish to remove this image?");h&&(f.removeData("image"),e.html(""),g.hide())}),a("body").on("click",".cw-attach-image",function(b){b.preventDefault();var c=a(this).closest(".widget");file_frame=wp.media.frames.file_frame=wp.media({title:a(this).data("uploader-title"),button:{text:a(this).data("uploader-button-text")},multiple:!1}),file_frame.on("select",function(){var a=file_frame.state().get("selection").first().toJSON(),b=a.id,d=a.url,e=c.find(".cw-inner-form"),f=e.find(".image-preview"),g=e.find(".cw-remove-image"),h=e.find(".cw-attach-image"),i='<img src="'+d+'">';f.html(i),g.show(),h.data("imageId",b),h.data("imageUrl",d)}),file_frame.open()}),a(window).load(function(){a(".cw-inner-form").each(function(){var c=a(this).closest(".widget");b(c)})})});